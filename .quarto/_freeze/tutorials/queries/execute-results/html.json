{
  "hash": "34be17f8f21eebe6835140589e6b279a",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Attribute and spatial queries\"\npage-layout: article\n---\n\n\n\n\n## Overview\nIn this tutorial, you will learn how to select geographic features based on their association with non-spatial and also based on their location.\n\n## Data Exploration\n\nSet working directory\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsetwd(\"C:/Users/devmbeya/Documents/giswithrtutorials\") \ngetwd() #check the file path of the current directory\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"C:/Users/devmbeya/Documents/giswithrtutorials\"\n```\n\n\n:::\n:::\n\n\n\n\nLoad required packages\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(sf)\nlibrary(dplyr)\n```\n:::\n\n\n\n\nRead data\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nafrica <- st_read(\"../assets/data/vector/africa.shp\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `africa' from data source \n  `C:\\Users\\devmbeya\\Downloads\\gis-remote-sensing-r\\assets\\data\\vector\\africa.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 55 features and 13 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -25.36042 ymin: -46.96575 xmax: 51.41704 ymax: 37.3452\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n\n```{.r .cell-code}\nafrica_project <- st_read(\"../assets/data/vector/africa_project.shp\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `africa_project' from data source \n  `C:\\Users\\devmbeya\\Downloads\\gis-remote-sensing-r\\assets\\data\\vector\\africa_project.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 55 features and 15 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -4296552 ymin: -3854841 xmax: 3987157 ymax: 4134822\nProjected CRS: Africa_Sinusoidal\n```\n\n\n:::\n\n```{.r .cell-code}\nafrica_continent <- st_read(\"../assets/data/vector/africa_continent.shp\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `africa_continent' from data source \n  `C:\\Users\\devmbeya\\Downloads\\gis-remote-sensing-r\\assets\\data\\vector\\africa_continent.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 1 feature and 6 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -25.36055 ymin: -34.822 xmax: 63.49576 ymax: 37.34041\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n\n```{.r .cell-code}\ncities <- st_read(\"../assets/data/vector/africa_capital_cities.shp\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `africa_capital_cities' from data source \n  `C:\\Users\\devmbeya\\Downloads\\gis-remote-sensing-r\\assets\\data\\vector\\africa_capital_cities.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 51 features and 14 fields\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: -23.521 ymin: -29.308 xmax: 47.528 ymax: 36.819\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n\n```{.r .cell-code}\nroads <- st_read(\"../assets/data/vector/africa_roads.shp\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `africa_roads' from data source \n  `C:\\Users\\devmbeya\\Downloads\\gis-remote-sensing-r\\assets\\data\\vector\\africa_roads.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 2581 features and 30 fields\nGeometry type: MULTILINESTRING\nDimension:     XY\nBounding box:  xmin: -17.45546 ymin: -34.2343 xmax: 49.41792 ymax: 37.10583\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n:::\n\n\n\n\n## Attribute queries\n\nGIS data comes in two forms: spatial and attribute data. Spatial data represents the aspects of geography inform of map layers. Attribute data in GIS describe the properties or characteristics of the spatial features. A school would have its spatial data represented as geographic coordinates(latitudes and longitudes) and its attribute data would include name of the school, student enrollment, number of teachers, name of district it is located in etc.\n\nAttribute queries select geographic features based on their association with attributes (non-spatial data). This is achieved by using conditions such as field names(e.g., `ADIMN`, `NAME`), operators (e.g., `<`, `>`, `=`, `==`) and values (e.g., `Malawi`, `TRUE`, `20000`).\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"true\"}\nafrica #print Africa sf\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 55 features and 13 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -25.36042 ymin: -46.96575 xmax: 51.41704 ymax: 37.3452\nGeodetic CRS:  WGS 84\nFirst 10 features:\n                         ADMIN ADM0_A3   POP_EST POP_RANK POP_YEAR GDP_MD\n1                     Ethiopia     ETH 112078730       17     2019  95912\n2                  South Sudan     SDS  11062113       14     2019  11998\n3                      Somalia     SOM  10192317       14     2019   4719\n4                        Kenya     KEN  52573973       16     2019  95503\n5                       Malawi     MWI  18628747       14     2019   7666\n6  United Republic of Tanzania     TZA  58005463       16     2019  63177\n7                   Somaliland     SOL   5096159       13     2014  17836\n8                      Morocco     MAR  36471769       15     2019 119700\n9               Western Sahara     SAH    603253       11     2017    907\n10       Republic of the Congo     COG   5380508       13     2019  12267\n   GDP_YEAR                   ECONOMY             INCOME_GRP CONTINENT\n1      2019 7. Least developed region          5. Low income    Africa\n2      2015 7. Least developed region          5. Low income    Africa\n3      2016 7. Least developed region          5. Low income    Africa\n4      2019   5. Emerging region: G20          5. Low income    Africa\n5      2019 7. Least developed region          5. Low income    Africa\n6      2019 7. Least developed region          5. Low income    Africa\n7      2013      6. Developing region 4. Lower middle income    Africa\n8      2019      6. Developing region 4. Lower middle income    Africa\n9      2007 7. Least developed region          5. Low income    Africa\n10     2019      6. Developing region 4. Lower middle income    Africa\n         SUBREGION                  REGION_WB               NAME_EN\n1   Eastern Africa         Sub-Saharan Africa              Ethiopia\n2   Eastern Africa         Sub-Saharan Africa           South Sudan\n3   Eastern Africa         Sub-Saharan Africa               Somalia\n4   Eastern Africa         Sub-Saharan Africa                 Kenya\n5   Eastern Africa         Sub-Saharan Africa                Malawi\n6   Eastern Africa         Sub-Saharan Africa              Tanzania\n7   Eastern Africa         Sub-Saharan Africa            Somaliland\n8  Northern Africa Middle East & North Africa               Morocco\n9  Northern Africa Middle East & North Africa        Western Sahara\n10   Middle Africa         Sub-Saharan Africa Republic of the Congo\n                         geometry\n1  MULTIPOLYGON (((34.0707 9.4...\n2  MULTIPOLYGON (((35.92084 4....\n3  MULTIPOLYGON (((46.46696 6....\n4  MULTIPOLYGON (((35.70585 4....\n5  MULTIPOLYGON (((34.96461 -1...\n6  MULTIPOLYGON (((32.92086 -9...\n7  MULTIPOLYGON (((48.93911 11...\n8  MULTIPOLYGON (((-8.817035 2...\n9  MULTIPOLYGON (((-8.817035 2...\n10 MULTIPOLYGON (((18.62639 3....\n```\n\n\n:::\n\n```{.r .cell-code  code-line-numbers=\"true\"}\n# Check column names, use the names() function\nnames(africa)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"ADMIN\"      \"ADM0_A3\"    \"POP_EST\"    \"POP_RANK\"   \"POP_YEAR\"  \n [6] \"GDP_MD\"     \"GDP_YEAR\"   \"ECONOMY\"    \"INCOME_GRP\" \"CONTINENT\" \n[11] \"SUBREGION\"  \"REGION_WB\"  \"NAME_EN\"    \"geometry\"  \n```\n\n\n:::\n\n```{.r .cell-code  code-line-numbers=\"true\"}\n# check coordinates of the polygons\nafrica$geom\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nGeometry set for 55 features \nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -25.36042 ymin: -46.96575 xmax: 51.41704 ymax: 37.3452\nGeodetic CRS:  WGS 84\nFirst 5 geometries:\n```\n\n\n:::\n\n```{.r .cell-code  code-line-numbers=\"true\"}\n# Check the ADMIN column values\nafrica$ADMIN\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"Ethiopia\"                         \"South Sudan\"                     \n [3] \"Somalia\"                          \"Kenya\"                           \n [5] \"Malawi\"                           \"United Republic of Tanzania\"     \n [7] \"Somaliland\"                       \"Morocco\"                         \n [9] \"Western Sahara\"                   \"Republic of the Congo\"           \n[11] \"Democratic Republic of the Congo\" \"Namibia\"                         \n[13] \"South Africa\"                     \"Libya\"                           \n[15] \"Tunisia\"                          \"Zambia\"                          \n[17] \"Sierra Leone\"                     \"Guinea\"                          \n[19] \"Liberia\"                          \"Central African Republic\"        \n[21] \"Sudan\"                            \"Djibouti\"                        \n[23] \"Eritrea\"                          \"Ivory Coast\"                     \n[25] \"Mali\"                             \"Senegal\"                         \n[27] \"Nigeria\"                          \"Benin\"                           \n[29] \"Angola\"                           \"Botswana\"                        \n[31] \"Zimbabwe\"                         \"Chad\"                            \n[33] \"Algeria\"                          \"Mozambique\"                      \n[35] \"eSwatini\"                         \"Burundi\"                         \n[37] \"Rwanda\"                           \"Uganda\"                          \n[39] \"Lesotho\"                          \"Cameroon\"                        \n[41] \"Gabon\"                            \"Niger\"                           \n[43] \"Burkina Faso\"                     \"Togo\"                            \n[45] \"Ghana\"                            \"Guinea-Bissau\"                   \n[47] \"Egypt\"                            \"Mauritania\"                      \n[49] \"Equatorial Guinea\"                \"Gambia\"                          \n[51] \"Bir Tawil\"                        \"Madagascar\"                      \n[53] \"Comoros\"                          \"São Tomé and Principe\"           \n[55] \"Cabo Verde\"                      \n```\n\n\n:::\n:::\n\n\n\n\n#### Subsetting vector data\n\nIn R, you van use `dplyr` subsetting functions to select a subset of the data: rows or columns. You can use the `filter()` and `slice` functions to select rows and `select()` to subset columns.\n\nSelect countries with population greater than 80 million. Use the dplyr's `filter()` function.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Once again explore the data\nhead(africa)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 6 features and 13 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 24.12156 ymin: -17.13534 xmax: 51.41704 ymax: 14.87953\nGeodetic CRS:  WGS 84\n                        ADMIN ADM0_A3   POP_EST POP_RANK POP_YEAR GDP_MD\n1                    Ethiopia     ETH 112078730       17     2019  95912\n2                 South Sudan     SDS  11062113       14     2019  11998\n3                     Somalia     SOM  10192317       14     2019   4719\n4                       Kenya     KEN  52573973       16     2019  95503\n5                      Malawi     MWI  18628747       14     2019   7666\n6 United Republic of Tanzania     TZA  58005463       16     2019  63177\n  GDP_YEAR                   ECONOMY    INCOME_GRP CONTINENT      SUBREGION\n1     2019 7. Least developed region 5. Low income    Africa Eastern Africa\n2     2015 7. Least developed region 5. Low income    Africa Eastern Africa\n3     2016 7. Least developed region 5. Low income    Africa Eastern Africa\n4     2019   5. Emerging region: G20 5. Low income    Africa Eastern Africa\n5     2019 7. Least developed region 5. Low income    Africa Eastern Africa\n6     2019 7. Least developed region 5. Low income    Africa Eastern Africa\n           REGION_WB     NAME_EN                       geometry\n1 Sub-Saharan Africa    Ethiopia MULTIPOLYGON (((34.0707 9.4...\n2 Sub-Saharan Africa South Sudan MULTIPOLYGON (((35.92084 4....\n3 Sub-Saharan Africa     Somalia MULTIPOLYGON (((46.46696 6....\n4 Sub-Saharan Africa       Kenya MULTIPOLYGON (((35.70585 4....\n5 Sub-Saharan Africa      Malawi MULTIPOLYGON (((34.96461 -1...\n6 Sub-Saharan Africa    Tanzania MULTIPOLYGON (((32.92086 -9...\n```\n\n\n:::\n\n```{.r .cell-code}\n# Select countries with population greater than 80 million\npop <- filter(africa, POP_EST > 80000000)\npop\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 4 features and 13 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 2.671082 ymin: -13.45835 xmax: 47.97917 ymax: 31.65648\nGeodetic CRS:  WGS 84\n                             ADMIN ADM0_A3   POP_EST POP_RANK POP_YEAR GDP_MD\n1                         Ethiopia     ETH 112078730       17     2019  95912\n2 Democratic Republic of the Congo     COD  86790567       16     2019  50400\n3                          Nigeria     NGA 200963599       17     2019 448120\n4                            Egypt     EGY 100388073       17     2019 303092\n  GDP_YEAR                   ECONOMY             INCOME_GRP CONTINENT\n1     2019 7. Least developed region          5. Low income    Africa\n2     2019 7. Least developed region          5. Low income    Africa\n3     2019   5. Emerging region: G20 4. Lower middle income    Africa\n4     2019   5. Emerging region: G20 4. Lower middle income    Africa\n        SUBREGION                  REGION_WB                          NAME_EN\n1  Eastern Africa         Sub-Saharan Africa                         Ethiopia\n2   Middle Africa         Sub-Saharan Africa Democratic Republic of the Congo\n3  Western Africa         Sub-Saharan Africa                          Nigeria\n4 Northern Africa Middle East & North Africa                            Egypt\n                        geometry\n1 MULTIPOLYGON (((34.0707 9.4...\n2 MULTIPOLYGON (((18.62639 3....\n3 MULTIPOLYGON (((3.5964 11.6...\n4 MULTIPOLYGON (((34.24835 31...\n```\n\n\n:::\n\n```{.r .cell-code}\n# Plot the selected polygons\nplot(pop$geometry)\n```\n\n::: {.cell-output-display}\n![](queries_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n\n\nSelect South Africa and Malawi polygons\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsouth_africa <- filter(africa, NAME_EN == 'South Africa' | NAME_EN==\"Malawi\")\n\nplot(south_africa$geometry)\n```\n\n::: {.cell-output-display}\n![](queries_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\n\nSelect Malawi's neighbors\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"true\"}\nmalawi_and_neighb <- filter(africa, NAME_EN == 'Malawi' | NAME_EN==\"Zambia\" | NAME_EN == \"Mozambique\" | NAME_EN == \"Tanzania\")\n\nplot(malawi_and_neighb$geometry)\n```\n\n::: {.cell-output-display}\n![](queries_files/figure-html/Select multiple attributes-1.png){width=672}\n:::\n:::\n\n\n\n\n## Spatial queries\n\nTo select features by their location, we can use topological relations between vector geometries.\n\nTo select features by their **location**, we can use topological relations between vector geometries in `sf`. Common functions include:\n\n-   `st_intersects(x, y)` – returns features in `x` that **intersect** features in `y`.\n-   `st_touches(x, y)` – returns features in `x` that **touch** features in `y` (share a boundary but do not overlap).\n-   `st_overlaps(x, y)` – returns features in `x` that **overlap** features in `y` partially.\n-   `st_contains(x, y)` – returns features in `x` that **contain** features in `y`.\n-   `st_contains_properly(x, y)` – stricter version of `st_contains`.\n-   `st_covers(x, y)` – returns features in `x` that **cover** features in `y`.\n-   `st_within(x, y)` – returns features in `x` that are **within** features in `y`.\n-   `st_covered_by(x, y)` – returns features in `x` that are **covered by** features in `y`.\n-   `st_disjoint(x, y)` – returns features in `x` that **do not intersect** features in `y`.\n\nSelect cities that are located within East African countries.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"true\"}\nplot(cities$geometry)\n```\n\n::: {.cell-output-display}\n![](queries_files/figure-html/Select data based on location-1.png){width=672}\n:::\n\n```{.r .cell-code  code-line-numbers=\"true\"}\n# Select countries within Eastern Africa\neast_africa <- filter(africa, SUBREGION == 'Eastern Africa')\n\n# Plot East African countries\nplot(east_africa$geometry)\n\n# Select and plot all eastern African cities\neast_cities <- st_intersection(x = cities, y=east_africa)\n\nplot(east_cities$geometry, add=TRUE, col='blue', pch=16)\n\nplot(cities$geometry, add=TRUE)\n```\n\n::: {.cell-output-display}\n![](queries_files/figure-html/Select data based on location-2.png){width=672}\n:::\n:::\n",
    "supporting": [
      "queries_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}